(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9568:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),r(908),r(4752),r(5866);var s=r(3191),a=r(8716),n=r(7922),i=r.n(n),l=r(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,908)),"/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,4752)),"/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/page.tsx"],u="/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},360:(e,t,r)=>{Promise.resolve().then(r.bind(r,8586))},8166:(e,t,r)=>{Promise.resolve().then(r.bind(r,8143))},4561:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},8586:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(326),a=r(7577);let n="auth_token";function i(){try{return!1}catch(e){return!1}}async function l(){if(!i())throw Error("storage-unavailable");try{let e=window.localStorage.getItem(n);if(null===e)return null;if("string"!=typeof e)throw Error("invalid-token-format");let t=e.trim();return""===t?null:t}catch(e){throw console.error("authStorage.getToken error",e),e}}async function o(e){if("string"!=typeof e||""===e.trim())throw Error("invalid-token");if(!i())throw Error("storage-unavailable");try{window.localStorage.setItem(n,e)}catch(e){throw console.error("authStorage.saveToken error",e),e}}async function c(){if(!i())throw Error("storage-unavailable");try{window.localStorage.removeItem(n)}catch(e){throw console.error("authStorage.removeToken error",e),e}}async function d(e){let t=await fetch("/api/bcs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"createOrder",...e})}),r=await t.json();if(!r.success)throw Error(r.error||"Ошибка создания заявки");return r.data}function u({instrumentId:e,instrumentName:t,instrumentTicker:r,onClose:n,onSuccess:i,onError:l}){let[o,c]=(0,a.useState)("market"),[u,m]=(0,a.useState)(""),[p,x]=(0,a.useState)(""),[h,g]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),v=u&&parseInt(u)>0&&("market"===o||p&&parseFloat(p)>0),y=async t=>{if(v){g(!0);try{let r=await d({instrumentId:e,side:t,type:o,quantity:parseInt(u),price:"limit"===o?parseFloat(p):void 0});f({success:!0,message:`Заявка ${r.orderId} успешно создана`}),i?.(r)}catch(t){let e=t instanceof Error?t.message:"Ошибка создания заявки";f({success:!1,message:e}),l?.(e)}finally{g(!1)}}};return b?s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md text-center",children:[s.jsx("div",{className:`text-4xl mb-4 ${b.success?"text-green-500":"text-red-500"}`,children:b.success?"✓":"✗"}),s.jsx("h2",{className:"text-xl font-bold mb-2",children:b.success?"Успешно":"Ошибка"}),s.jsx("p",{className:"text-gray-600 mb-6",children:b.message}),s.jsx("button",{onClick:n,className:"w-full py-3 bg-blue-500 text-white rounded-lg font-medium",children:"Вернуться в портфель"})]})}):s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-xl font-bold",children:t}),s.jsx("span",{className:"text-gray-500",children:r})]}),s.jsx("button",{onClick:n,className:"text-gray-400 text-2xl",children:"\xd7"})]}),s.jsx("div",{className:"flex gap-2 mb-4",children:["market","limit"].map(e=>s.jsx("button",{onClick:()=>c(e),className:`flex-1 py-2 rounded-lg ${o===e?"bg-blue-500 text-white":"bg-gray-100"}`,children:"market"===e?"Рыночная":"Лимитная"},e))}),s.jsx("input",{type:"number",placeholder:"Количество, шт.",value:u,onChange:e=>m(e.target.value),min:"1",className:"w-full p-3 border rounded-lg mb-3"}),"limit"===o&&s.jsx("input",{type:"number",placeholder:"Цена",value:p,onChange:e=>x(e.target.value),step:"0.01",min:"0.01",className:"w-full p-3 border rounded-lg mb-3"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>y("buy"),disabled:!v||h,className:"flex-1 py-3 bg-green-500 text-white rounded-lg font-medium disabled:opacity-50",children:h?"...":"Купить"}),s.jsx("button",{onClick:()=>y("sell"),disabled:!v||h,className:"flex-1 py-3 bg-red-500 text-white rounded-lg font-medium disabled:opacity-50",children:h?"...":"Продать"})]})]})})}function m(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)(""),[i,l]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[d,m]=(0,a.useState)(null),[p,x]=(0,a.useState)(null);(0,a.useCallback)(async()=>{try{let e=await fetch("/api/bcs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"accounts"})}),r=await e.json();r.success&&r.data?.length&&(t(r.data),n(r.data[0].id))}catch(e){m("Ошибка загрузки счетов")}},[]);let h=(0,a.useCallback)(async()=>{if(r){c(!0);try{let e=await fetch("/api/bcs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"portfolio",accountId:r})}),t=await e.json();t.success?l(t.data?.positions||[]):m(t.error||"Ошибка загрузки портфеля")}catch(e){m("Ошибка загрузки портфеля")}finally{c(!1)}}},[r]),g=e=>{x({instrumentId:e.instrumentId,name:e.name,ticker:e.ticker})};return d?s.jsx("div",{className:"p-4 text-red-500",children:d}):o?s.jsx("div",{className:"p-4",children:"Загрузка..."}):(0,s.jsxs)("div",{className:"p-4",children:[e.length>1&&s.jsx("select",{value:r,onChange:e=>n(e.target.value),className:"w-full p-2 border rounded mb-4",children:e.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))}),(0,s.jsxs)("div",{className:"space-y-2",children:[i.map(e=>s.jsx("div",{onClick:()=>g(e),className:"p-4 bg-white rounded-lg shadow cursor-pointer hover:bg-gray-50",children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[e.ticker," \xb7 ",e.quantity," шт."]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"font-medium",children:[(e.totalValue??0).toLocaleString("ru-RU")," ₽"]}),(0,s.jsxs)("div",{className:e.profitLoss>=0?"text-green-500":"text-red-500",children:[e.profitLoss>=0?"+":"",(e.profitLoss??0).toLocaleString("ru-RU")," ₽ (",(e.profitLossPercent??0).toFixed(2),"%)"]})]})]})},e.instrumentId)),0===i.length&&s.jsx("div",{className:"text-gray-500 text-center py-8",children:"Портфель пуст"})]}),p&&s.jsx(u,{instrumentId:p.instrumentId,instrumentName:p.name,instrumentTicker:p.ticker,onClose:()=>x(null),onSuccess:()=>{x(null),h()},onError:e=>console.error("Order error:",e)})]})}let p=({storageError:e,onSaved:t})=>{let[r,n]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null);return s.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md shadow-lg",children:[s.jsx("h2",{className:"text-2xl font-bold mb-2 text-center",children:"Добавить токен"}),s.jsx("p",{className:"text-gray-500 text-center mb-6",children:"Введите ваш API токен для доступа к торговле"}),e&&(0,s.jsxs)("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm",children:["Ошибка хранилища: ",e]}),s.jsx("input",{"aria-label":"auth-token",value:r,onChange:e=>n(e.target.value),placeholder:"Вставьте ваш токен",className:"w-full p-3 border rounded-lg mb-4"}),s.jsx("button",{onClick:async()=>{if(d(null),!r||""===r.trim()){d("Токен не может быть пустым");return}l(!0);try{await o(r.trim()),t()}catch(e){console.error("Failed to save token",e),d(e.message||"Ошибка сохранения")}finally{l(!1)}},disabled:i,className:"w-full py-3 bg-blue-500 text-white rounded-lg font-medium disabled:opacity-50",children:i?"Сохранение...":"Сохранить"}),c&&s.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mt-4 text-sm",children:c})]})})},x=()=>{let[e,t]=(0,a.useState)(!0),[r,n]=(0,a.useState)(null),[i,o]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await l();if(!e)return;t&&o(!0)}catch(e){n(e?.message||"storage-error")}finally{e&&t(!1)}})(),()=>{e=!1}},[]),e)?s.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:s.jsx("div",{className:"text-gray-500",children:"Загрузка..."})}):i?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsxs)("div",{className:"bg-white shadow-sm p-4 flex justify-between items-center",children:[s.jsx("h1",{className:"text-xl font-bold",children:"Портфель"}),s.jsx("button",{onClick:async()=>{try{await c(),o(!1)}catch(e){console.error("Logout failed",e)}},className:"text-red-500 text-sm",children:"Выйти"})]}),s.jsx(m,{})]}):s.jsx(p,{storageError:r,onSaved:()=>o(!0)})};function h(){return s.jsx(x,{})}},8143:(e,t,r)=>{"use strict";r.d(t,{TelegramUIProvider:()=>i});var s=r(326),a=r(7577),n=r(1388);function i({children:e}){let[t,r]=(0,a.useState)(!1);return t?s.jsx(n.h7,{children:e}):s.jsx(s.Fragment,{children:e})}r(3898)},4752:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m,metadata:()=>u});var s=r(9510),a=r(5384),n=r.n(a);r(7272);var i=r(8570);let l=(0,i.createProxy)(String.raw`/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/providers.tsx`),{__esModule:o,$$typeof:c}=l;l.default;let d=(0,i.createProxy)(String.raw`/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/providers.tsx#TelegramUIProvider`),u={title:"Trade Mini App",description:"Telegram Mini App for trading"};function m({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{className:n().className,children:s.jsx(d,{children:e})})})}},908:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var s=r(8570);let a=(0,s.createProxy)(String.raw`/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/page.tsx`),{__esModule:n,$$typeof:i}=a;a.default;let l=(0,s.createProxy)(String.raw`/private/var/folders/x_/_59zd7251395fzzp4pyqbl7h0000gn/T/vibe-kanban/worktrees/9483-/trade-mini-app/app/page.tsx#default`)},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,802],()=>r(9568));module.exports=s})();